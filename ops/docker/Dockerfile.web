FROM node:20-bullseye AS build
WORKDIR /app
# Only copy the web app folder into the build context inside the image
COPY src/web/package*.json ./
COPY src/web/ ./
RUN npm ci && npm run build

FROM nginx:1.27-alpine
COPY --from=build /app/dist /usr/share/nginx/html
# nginx.conf remains in ops/docker relative to the repo root build context
COPY ops/docker/nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
